---
import { getCollection } from "astro:content";
import Shell from "../../layouts/Shell.astro";
import Footer from "../../components/Footer.astro";
import { productFromUrl } from "../../lib/products";
import ProductNav from "../../components/nav/product/Nav.astro";
import FilterGrid from "../../components/showcase/FilterGrid.svelte";

const product = productFromUrl(Astro.url);

const items = (
	await getCollection(
		"showcase",
		({ data }) => !product || data.tags.includes(product.name),
	)
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// When we pass props to FilterGrid, we only want to pass data that is actually needed
// because Astro will serialize all props to JSON for client hydration.
const itemsData = items.map((item) => ({ ...item.data, slug: item.slug }));

const description =
	"Discover dozens of amazing projects built with " +
	(product?.name ?? "Leaning Technologies") +
	".";
---

<Shell
	title={["Showcase", product?.name ?? "Leaning Technologies"].join(" - ")}
	{description}
>
	{product && <ProductNav {product} />}
	<header class="text-center text-stone-100 py-16">
		<h1 class="text-6xl font-semibold">Showcase</h1>
		<p class="text-lg text-balance my-8 text-stone-400">
			{description}
		</p>
	</header>
	<main class="container mx-auto p-3 pb-16">
		<FilterGrid items={itemsData} enableTechnologyFilterGroup={!product} client:load />
	</main>
	<Footer />
</Shell>
